<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title id="cont">PAI</title>
<link rel="shortcut icon" href="icon/pai.png"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="css/w3.css">
<meta name="theme-color" content="#ffffff">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="icon" type="image/png" href="icon/pai.png" >
<meta name="application-name" content="PAI">
<link rel="stylesheet" href="font-awesome/6.1.1/css/all.css">
<script src="js/jquery-3.6.0.min.js"></script>
<script src="cordova.js"></script>
<script type="text/javascript" charset="utf-8">
        $(document).ready(function () {
             document.addEventListener("deviceready", onDeviceReady, false); 


        });

        function onDeviceReady() {

            StatusBar.overlaysWebView(false);
            StatusBar.backgroundColorByHexString("#ffffff"); 
            StatusBar.styleDefault();
            //StatusBar.styleLightContent();

        }
</script>
<style>
html,body,h1,h2,h3,h4,h5 {font-family: "RobotoDraft", "Roboto", sans-serif;}
.blue-dark{background-color:#1565c0}
.blue-menu{color:#1565c0}

.noselect {
     
-webkit-user-select: none;
-khtml-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
            
}

textarea,input:not([type="radio"]):not([type="checkbox"]) {
    -webkit-appearance: none;
    border-radius: 0;
}
</style>
</head>
<body class="w3-white noselect w3-col l5" style="padding-top: constant(safe-area-inset-top);padding-top: env(safe-area-inset-top);">

<!-- Page content -->
<div id="notifigener" class="w3-animate-top w3-col m12 s12 l12 w3-container w3-center" style="position:fixed;display:none;z-index:2"></div>


 <div class="w3-container w3-white">

<div class="w3-margin-top w3-margin-bottom w3-container">   
  <h1 class="w3-text-black w3-center"><b>Recuperación de cuenta</b></h1>
  <center><img src="icon/pai.png" class="w3-circle w3-light-grey" width="70px">
      <small class="w3-col s12 m12 l12"><b>PAI E</b>xchange</small>
  </center><br><br>
<div id="loginarea">  

 <div id="session0">
       <div class="w3-margin-bottom  w3-margin-top">
           <i class="fas fa-at w3-col s2 m2 l2 w3-xlarge w3-text-cyan w3-padding-top w3-margin-top"></i>
           <input class="w3-input w3-col s10 m10 l10 w3-border-bottom w3-large w3-margin-bottom w3-white w3-margin-top" type="email" id='email' placeholder="Email de su cuenta" style="outline:none">
           
           <h6 class="w3-text-blue-grey w3-col s12 m12 l12 w3-margin-top w3-left"><i class="fas fa-info-circle"></i> Introduzca el correo electrónico asociado a su cuenta.</h6>
       </div>
       
       <button class="w3-btn w3-blue w3-col s12 w3-large w3-round-xxlarge w3-margin-top w3-margin-bottom" onclick="enviarCodigo($('#email').val())"> Siguiente </button>
 </div>

 
 <div id="session1" class="w3-animate-left" style="display:none">
     
      <div class="w3-margin-bottom  w3-margin-top">
               <input class="w3-input w3-col s12 w3-border-bottom w3-large w3-margin-bottom w3-white" type="text" id='cod'  placeholder="Código de confirmación" style="outline:none;text-align:center">
      </div>
      <h6 class="w3-text-blue-grey w3-col s12 m12 l12 w3-margin-top w3-left"><i class="fas fa-info-circle"></i> Pegue el código recibido en su correo electrónico.</h6>

     <button class="w3-btn w3-blue w3-col s12 w3-large w3-round-xxlarge w3-margin-top" onclick="if($('#cod').val().length>4){ $('#session1').hide();$('#session2').show()}"> Siguiente </button>
   
 </div>
   
 <div id="session2" class="w3-animate-left" style="display:none">
   
    <div class="w3-margin-bottom  w3-margin-top">
              <input  class="w3-input w3-col s12 w3-border-bottom w3-large w3-margin-bottom w3-white" type="password" id='nueva' onchange="valid5(value)" placeholder="Contraseña nueva" style="outline:none">
    </div>
   
    <div class="w3-margin-bottom  w3-margin-top">
             <input class="w3-input w3-col s12 w3-border-bottom w3-large w3-margin-bottom w3-white" type="password" id='confirmar'  onchange="valid8(value)" placeholder="Confirmar contraseña" style="outline:none">
    </div>
  
    
          
    <div class="w3-margin-bottom w3-margin-top">
            <button id="sigtfinal" class="w3-btn w3-blue w3-col s12 w3-large w3-round-xxlarge w3-margin-top" onclick="Restablecer($('#cod').val(),$('#nueva').val(),$('#confirmar').val())"> Cambiar contraseña </button>
    </div>
    
  
 </div>
  
   <div id="session3" class="w3-animate-left" style="display:none">
        <center>
        <i class="far fa-check-circle w3-xxxlarge w3-text-green"></i>
        <i class="far fa-check-circle w3-xxxlarge w3-text-green"></i>
        <i class="far fa-check-circle w3-xxxlarge w3-text-green"></i>
        <p>Cambio exitoso</p>
        </center>
   </div>
  
</div>   


</div>
  
  
  <div class="w3-padding-32 w3-center w3-text-cyan">
     <a href="login.html" style="text-decoration:none">Haga clic aquí para iniciar sesión</a>
  </div>

 <div class="w3-margin-bottom w3-text-blue-grey w3-container w3-center">          
     <p> ® PAI Exchange.</p>
  </div>
</div>

      

 
<!-- // Page content END--> 


<!-- Loader -->
<div id="loadergif" class="w3-modal">
  <div class="w3-display-middle">
  <center>
      <img src="icon/loader.gif" class="w3-round" width="70">
  </center>    
  </div>
</div>
<!-- // Loader// -->

<script>
if(/(http)/i.test(window.location.protocol))
{
    UrlAPI=window.location.hostname;
}
else
{
    UrlAPI='api.paiexchange.com';
}
</script>
<script>
function NotifiAlert(mensaje,color,tiempo)
{
     if(color=='w3-green'){ remov='w3-red'; } else { remov='w3-green'; }
     
     $("#notifigener").removeClass(remov).addClass(color);
     $("#notifigener").html("<p>"+mensaje+"</p>");
     $("#notifigener").show();
     setTimeout(function(){ $("#notifigener").hide(); }, tiempo);
}     
</script>

<script>
function enviarCodigo(email)
{
  
if(email=='')
{
      NotifiAlert("Debe completar todos los datos",'w3-red','4000');    
}
else
{
       
  
var parametros = {
"email" : email
};
$.ajax({
data: parametros,
url: 'https://'+UrlAPI+'/AppRestablecerSendcode',
type: 'post',
beforeSend: function() 
{
 $('#loadergif').show();
},
success: function (response)
{

  $("#loadergif").hide();
  var objt=JSON.parse(response);

  if(objt.status=='ok')
  {
    $('#session0').hide();
    $('#session1').show();
  }
  else if(objt.status=='error')
  {
    NotifiAlert(objt.result,'w3-red','4000');
  }
  else
  {
      NotifiAlert("Hay un problema con el servidor",'w3-red','4000');
  }
  
},

error: function (response)
{

     NotifiAlert("Favor verifique su conexión a internet",'w3-red','4000');
     $("#loadergif").hide();
}

});
 
}
 }
</script>
<script>
function Restablecer(codigo,nueva,confirmar){
    
if(codigo=='' || nueva=='' || confirmar=='')
{
   NotifiAlert("Por favor rellene todos los datos",'w3-red','4000');
}    
else if(nueva!==confirmar)
{
    NotifiAlert("Las contraseñas no coinciden",'w3-red','4000');
}
else
{

var parametros = {
"codigo" : codigo,
"nueva" : nueva, 
"confirmar" : confirmar
};
$.ajax({
data: parametros,
url: 'https://'+UrlAPI+'/AppRestablecerCuenta',
type: 'post',
beforeSend: function () 
{
 $('#loadergif').show();
},
success: function (response)
{

  $("#loadergif").hide();
  var objt=JSON.parse(response);

  if(objt.estado=='ok')
  {

    $('#session2').hide();
    $('#session3').show();    
    
  }
  else if(objt.estado=='code')
  {
     NotifiAlert(objt.msj,'w3-red','4000');
    $('#session2').hide();
    $('#session1').show();
  }
  else
  {
      NotifiAlert(objt.msj,'w3-red','4000');
  }
  
},

error: function (response)
{

     NotifiAlert("Favor verifique su conexión a internet",'w3-red','4000');
     $("#loadergif").hide();
}

});
 }
}
</script>

<script>
//psw

function valid5(value)
{

    if(value.length>15 || value.length<6)
    {
        //value=value.slice(0,16);
        NotifiAlert("La contraseña escrita es muy corta o muy extensa",'w3-red','4000');
        $("#nueva").val(value);
        $("#nueva").addClass('w3-border-red');
        //$("#psw").focus();
        $("button").attr("disabled", "disabled");
    }
    else if(!/^[0-9a-zA-Z.-@]*$/i.test(value))
    {
        NotifiAlert("Ha introducido caracteres inválidos",'w3-red','4000');
        $("#nueva").val(value);
        $("#nueva").addClass('w3-border-red');
        //$("#psw").focus();
        $("button").attr("disabled", "disabled");
    }         
    else
    {
       $("button").removeAttr('disabled'); 
       $("#nueva").removeClass('w3-border-red').addClass('w3-border-green');
    }

}





</script>
</body>
</html>