<div class="w3-col l8 w3-padding w3-white">
  <div class="w3-col l12" id="datsl">
    <h5>Vender</h5>

    <small class="w3-col l12 m12 s12 w3-margin-top">Balance disponible</small>
    <div class="w3-col s12 m12 l12 w3-margin-bottom">
      <div class="w3-col s7 m6 l6 w3-xlarge" onclick="montorapido('Vbalance')" id="Vbalance">&nbsp;</div>
      <div class="w3-col s5 m6 l6 w3-right">
        <bottom onclick="OpenOtherOption('submenu/config/Metodo de pago','Metodo de pago')"
          class="w3-btn w3-dark-grey w3-round w3-right">+ <i class="fa-solid fa-building-columns"></i></bottom>
      </div>
    </div>

    <small class="w3-col l12 m12 s12">Método de pago</small>
    <select id="mediopago" class="w3-select w3-padding-16 w3-margin-bottom w3-round w3-border">
      <option disabled value="" selected>Seleccione una forma de pago</option>
    </select>

    <div class="w3-col s12 m12 l12 w3-margin-bottom">
      <div class="w3-col s5 m5 l5">
        <small class="w3-col s12 l12 m12">Valor de la venta</small>
        <input type="number" min="1" step="1" class="w3-input w3-padding-16 w3-round w3-border w3-col s10 l10 m10" id="Vcantidad"
          oninput="calcularVenta(value)" placeholder="USD$0.00">
      </div>
      <div class="w3-col s7 m7 l7">
        <div class="w3-col s5 m5 l5">
          <small class="w3-col s12 l12 m12">Mínimo</small>
          <label class="w3-btn w3-dark-grey w3-col s12 l12 m12 w3-round w3-padding-16 w3-border" onclick="montorapido('Vmin')"
            id="Vmin">&nbsp;</label>
        </div>
        <div class="w3-col s7 m7 l7 w3-padding-left">
          <small class="w3-col s12 l12 m12">Máximo</small>
          <label class="w3-btn w3-dark-grey w3-col s12 l12 m12 w3-round w3-padding-16 w3-border" onclick="montorapido('Vmax')"
            id="Vmax">&nbsp;</label>
        </div>
      </div>
    </div>

    <div
      class="w3-col m12 l12 s12 w3-container w3-margin-bottom w3-border w3-round w3-round-large w3-small">
      <div class="w3-col s7 m7 l7 w3-container">Tasa/Precio variable:</div>
      <div class="w3-col s5 m5 l5 w3-container"><span id="Vtasa">&nbsp;</span> DOP x USD</div>

      <div class="w3-col s7 m7 l7 w3-container">Entrega:</div>
      <div class="w3-col s5 m5 l5 w3-container"><span id="Ventrega">&nbsp;</span></div>

      <div class="w3-col s7 m7 l7 w3-container">Total a recibir:</div>
      <div class="w3-col s5 m5 l5 w3-container" id="totalrecibir">DOP 0.00</div>
    </div>


    <bottom class="w3-btn w3-blue w3-col s12 m12 l12 w3-round w3-margin-bottom"
      onclick="pay($('#Vcantidad').val(),$('#mediopago').val());">Vender</bottom>


  </div>


</div>

<script>
  $(document).ready(function() { $(".menu-lateral").load('submenu/menu-lateral.html') })
</script>
<div class="menu-lateral w3-col l4 w3-hide-small w3-hide-medium"></div>


<div class="w3-container w3-col l12 w3-white w3-padding">
  <h4>Historial</h4>
  <div id="trst0" style="display:none" class="w3-padding-64 w3-center">No hay transacciones disponible</div>
</div>

<!-- KYC-->
<div id="nokyc" class="w3-modal noselect w3-col l12" style="display:none">
  <div class="w3-display-middle  w3-white w3-round w3-round-xlarge w3-animate-fade  w3-col l5 m5 s">
    <div class="reajuste" align="justify">
      <center class="w3-padding-8 w3-container">
        <h4>Es requerido tener la verificación KYC.</h4>
      </center>
      <div class="w3-container" style="overflow-y:scroll;max-height:430px">
        <p>No es un cliente verificado por favor verifique su cuenta haciendo clic en el botón mas abajo.</p>
        <p>Este servicio esta disponible solo para República Dominicana.</p>
      </div>

    </div>

    <div class="w3-col s12 m12 l12 w3-large w3-padding-16 w3-center  w3-border-top w3-border-lightgrey w3-text-blue"
      style="cursor:pointer" onclick="OpenOtherOption('submenu/config/kyc','Verificar')">Verificar</div>
  </div>
</div>
<!-- //KYC// -->

<!-- Terminos de USO-->
<div id="ventatermin" class="w3-modal noselect w3-col l5" style="display:none">
  <div class="w3-display-middle  w3-white w3-round w3-round-xlarge w3-animate-fade  w3-col l10 m10 s10">
    <div class="reajuste" align="justify">
      <center class="w3-padding-8 w3-container">
        <h4>Términos y condiciones de uso.</h4>
      </center>
      <div class="w3-container" style="overflow-y:scroll;max-height:430px">
        *El presente servicio le permite al usuario vender sus criptoactivos y recibir un
        pago según el precio de compra designado por PAI Exchange en el método de pago seleccionado por el usuario. Por
        consiguiente
        el usuario al dar uso de nuestros servicios confirma y acepta los siguientes terminos.
        <br><br>

        1- Debe proporcionar un método de pago a su nombre, y nos autoriza a enviar pagos al mismo.
        <br><br>
        2- El usuario reconoce que la tasa o precio de compra de sus criptoactivos <b>es variable al monto
          introducido</b> y no puede ser alterada una vez que su transacción ha sido procesada, por consiguiente
        debe confirmar antes de enviar cada transacción.
        <br><br>
        3- El usuario reconoce que una vez una transacción es procesada no puede ser cancelada.
        <br><br>
        4- El usuario es el responsable de las transacciones recibidas en su método de pago.
        <br><br>
        5- El usuario acepta que el tiempo de entrega no es inmediato y en ciertos casos puede ser demorado por
        circunstancias imprevistas.
        <br><br>
        6- PAI Exchange se reserva el derecho de modificar o actualizar estos términos y condiciones según sea
        requerido.
        <br><br>
        * Al aceptar los términos y condiciones de uso acepta nuestras políticas y reglamentos por lo cual reconoce que
        no dará uso
        para actividades ilícitas que puedan causar perjuicios y daños a nuestra marca, siendo usted responsable de los
        daños causados.
        <br>

        <center><input class="w3-margin-bottom w3-margin-top" type="checkbox" id="checkarea"
            onclick="habilitaraceptar()"> Acepto estos términos y condiciones.</center>

      </div>

    </div>

    <div id="infoacept"
      class="w3-col s12 m12 l12 w3-large w3-padding-16 w3-center  w3-border-top w3-border-lightgrey w3-text-blue"
      style="cursor:pointer" onclick="$('#checkarea').focus()">Aceptar</div>
  </div>
</div>
<!-- //Terminos de USO// -->

<script>
  EstatusBarColor('595759');
  function habilitaraceptar() {
    var accions = "$('#ventatermin').hide();localStorage.setItem('ventatermino', 'aceptado');";
    $('#infoacept').attr('onclick', accions)
  }
</script>
<script>
  function pay(monto, id) {
    if ($("#mediopago option").length == 0) {
      NotifiAlert('Por favor configure un método de pago', 'w3-red', 3000);
    }
    else if (monto == '') {
      NotifiAlert('El monto a vender es requerido', 'w3-red', 3000);
    }
    else if (id == null) {
      NotifiAlert('Seleccione un método de pago', 'w3-red', 3000);
    }
    else {


      var parametros = {
        "monto": monto,
        "id": id

      };
      $.ajax({
        data: parametros,
        url: 'https://' + UrlAPI + '/AppVender',
        type: 'post',
        beforeSend: function () {
          $("#loadergif").show();

        },
        success: function (response) {

          $('#loadergif').hide();
          if (response == '') {
            NotifiAlert('No se ha obtenido resultados, compruebe su conexión', 'w3-red', 6000);
          }
          else {

            var objt = JSON.parse(response);
            if (objt.session == 'true') {
              if (objt.estado == 'error2') {
                $("#notifigener").removeClass('w3-green').addClass('w3-red');
                $("#notifigener").html("<p>" + objt.mensaje + "</p>");
                $("#notifigener").show();
                setTimeout(function () { $("#notifigener").hide(); OpenOption('Opciones'); }, 6000);
              }
              else if (objt.estado == 'ok') {
                OpenOption('Vender');
                NotifiAlert(objt.mensaje, 'w3-green', 6000);
              }
              else {
                NotifiAlert(objt.mensaje, 'w3-red', 6000);
              }


            }
            else {
              CerrarSesion();
            }

          }
        },

        error: function (response) {
          NotifiAlert('Verifique su conexión a internet', 'w3-red', 6000);
          $('#loadergif').hide();
          $('#loaderspin').hide();
        }

      });

    }

  } 
</script>

<script>
  function montorapido(id) {
    var monto = $('#' + id).html().replace('$', '').replace('USD ', '').replace(',', '');
    $('#Vcantidad').val(monto);
    calcularVenta(monto);
  }
</script>
<script>
  //Calculadora de conversion
  function calcularVenta(monto) {
    var tasa = PrecioTasa;
    $('#Vtasa').html(tasa).removeClass('w3-text-orange');
    if (monto < 100 && monto > 0) {
      //=
      tasa = tasavariable;
      $('#Vtasa').html(tasa).addClass('w3-text-orange');
    }
    $('#totalrecibir').html('DOP ' + formatonumero(tasa * monto, 0) + '.00');


  }
</script>

<script>
  tipohistorial = '';
  objt = '';
  pagtotal = '';
  paglimite = '';
  PrecioTasa = '';
  tasavariable = '';
  function AreaVentas(pagina) {


    $.ajax({
      url: 'https://' + UrlAPI + '/AppVentasDatos',
      type: 'post',
      data: { pagina: pagina },
      beforeSend: function () {
        $('#loadergif').show();
        //$('#loaderspin').show();   
      },
      success: function (response) {
        $('#loadergif').hide();
        if (response == '') {
          NotifiAlert('No se ha obtenido resultados, compruebe su conexión', 'w3-red', 6000);
        }
        else {

          objt = JSON.parse(response);
          if (objt.session == 'true') {



            //paginacion
            pagtotal = objt.paginas.total;
            paglimite = objt.paginas.maximo;
            pagina = pagina - 1;

            $('#datsl').attr('pagtotal', pagtotal);
            $('#datsl').attr('paglimite', paglimite);
            $('#datsl').attr('pagina', pagina + 1);

            //venta minima y maxima
            $('#Vmin').html('$' + objt.minimo);
            $('#Vmax').html('$' + objt.maximo);

            //balance y otro
            $('#Vbalance').html('USD ' + formatonumero(objt.balance, 2));
            $('#Vtasa').html(objt.tasa);
            $('#Ventrega').html(objt.entrega);
            PrecioTasa = objt.tasa;
            tasavariable = objt.tasavariable;

            //para los clientes no KYC
            if (objt.kyc !== 'si') {
              $('#nokyc').show();
            }
            //terminos de ventas
            if (localStorage.getItem('ventatermino') !== 'aceptado' && objt.kyc == 'si') {
              $('#ventatermin').show();
            }

            //agregando  bancos para las nueva ordenes y borrando para que no se repita
            $('#mediopago').children('option:not(:first)').remove();
            for (i = 0; i < objt.formadepago.length; i++) {
              if (objt.formadepago[i].aprobada == 'si') {
                $('#mediopago').append('<option value="' + objt.formadepago[i].id + '">' + objt.formadepago[i].banco + ' ' + objt.formadepago[i].cuenta + ' ' + objt.formadepago[i].moneda + '</option>');
              }
              else {
                $('#mediopago').append('<option disabled value="' + objt.formadepago[i].id + '">' + objt.formadepago[i].banco + ' ' + objt.formadepago[i].cuenta + ' ' + objt.formadepago[i].moneda + '(Pendiente)</option>');
              }

            }


            //transacciones
            if (objt.content.length > 0) {


              for (i = 0; i < objt.content.length; i++) {

                //estados
                if (objt.content[i].estado == 'pagado') {
                  var estado = '<i class="fas fa-check-circle w3-text-green w3-xlarge"></i>';
                }
                else if (objt.content[i].estado == 'pendiente') {
                  var estado = '<i class="far fa-clock w3-text-grey w3-xlarge"></i>';
                }
                else {
                  var estado = '<i class="fas fa-ban w3-text-red w3-xlarge"></i>';
                }


                var contanido = '<div class="w3-border-bottom w3-border-light-grey w3-padding-8  w3-col s12"  id="trst' + ((parseFloat(pagina) * parseFloat(paglimite)) + parseFloat(i) + parseFloat(1)) + '">';
                contanido += '<div class="w3-col s2 noselect w3-padding-top">' + estado + '</div>';
                contanido += '<div class="w3-col m10 l10 s10"><div class="w3-col s6 m6 l6 noselect w3-small w3-padding-bottom"><div class="w3-col s12 m12 l12">' + objt.content[i].banco + '</div><span> ' + objt.content[i].cuenta + '</span></div>';
                contanido += '<div class="w3-col s6 m6 l6 reajuste"><div class="w3-col m12 l12 s12"><span class="w3-right w3-padding-right">' + formatonumero(objt.content[i].monto * objt.content[i].tasa, 0) + '.00 DOP</span></div><div class="w3-col m12 l12 s12"><small class="w3-right w3-padding-right">' + objt.content[i].fecha + '</small></div></div>';

                contanido += '</div></div>';

                $("#trst" + ((parseFloat(pagina) * parseFloat(paglimite)) + parseFloat(i))).after(contanido);
              }

              $("#trst0").remove();
              $('#loaderspin').hide();
              $('#loadergif').hide();

            }
            else {
              $('#loaderspin').hide();
              $('#loadergif').hide();
              $("#trst0").show();
            }

          }
          else {
            CerrarSesion();
          }



        }


      },

      error: function (response) {
        NotifiAlert('Verifique su conexión a internet', 'w3-red', 6000);
        $('#loadergif').hide();
        $('#loaderspin').hide();
      }

    });
  }
  AreaVentas(1);
</script>
<script>
  $(document).ready(function () {
    evitardupl = 0;

    $(window).scroll(function () {
      if (verarea() == 'Vender') {
        if ($(window).scrollTop() + $(window).height() + 76 >= $(document).height()) {
          var pagactual = Number($('#datsl').attr('pagina'));
          var totalpag = Number($('#datsl').attr('pagtotal'));
          var maximoporpag = Number($('#datsl').attr('paglimite'));

          if (pagactual > evitardupl) {
            if (pagactual < (totalpag / maximoporpag)) {
              AreaVentas((pagactual + 1));
              $('#loadergif').show();
              //window.scrollBy(0, -1);
              evitardupl = pagactual;
            }

          }
        }
      }
    });

  });
</script>