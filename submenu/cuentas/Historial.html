<div class="w3-white w3-padding-16 w3-container noselect w3-col s12 m12 l12">
    <h5 class="" id="histr">Historial <span class="w3-right" id="totalhist"></span></h5> 
</div>

<div class="" id="datsl">
<div class="w3-col l8 w3-white noselect w3-padding-top">
 <div class="w3-center w3-container"  style="display:none" id="trst0">
  <h5>Sin transacciones</h5>
   <p>Aquí podrá ver las últimas transacciones recibidas a su cartera.</p>
 </div>
</div>

<script>
  $(document).ready(function() { $(".menu-lateral").load('submenu/menu-lateral.html') })
</script>
<div class="w3-col l4 w3-hide-small w3-hide-medium">
  <div class="menu-lateral"></div>
</div>

</div>






<script>
EstatusBarColor('ffffff');
$('#menusup').hide();

//Variables Glabales
var simbolo='Todos';
var moneda='Todos';
var decimales=4;

function formatNumber(num,decimales) {
    num=parseFloat(num).toFixed(decimales);
    if(decimales>2)
    {
        return num;
    }
    else
    {
       return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
    }   
}
function historialcripto(pagina)
{
var datos= {
'tipo':moneda,
'codigo':simbolo,
'pagina':pagina
}

$.ajax({
data: datos,
url: 'https://'+UrlAPI+'/AppAddrTrstion',
type: 'post',
beforeSend: function ()
{
   //$('#loadergif').show();
},
success: function (response)
{
  $('#loadergif').hide(); 
  if(response=='')
  { 

     NotifiAlert("No se ha obtenido resultados, compruebe su conexión",'w3-red',5000);
  }
  else 
  {
  
    var objt=JSON.parse(response);
    if(objt.session=='true')
    {
    
          
      
        //transacciones
        if(objt.content.length>0)
        {   
        
                     
           //paginacion
           pagtotal=objt.paginas.total;
           paglimite=objt.paginas.maximo;
           pagina=pagina-1;
         
           $('#datsl').attr('pagtotal',pagtotal);
           $('#datsl').attr('paglimite',paglimite);
           $('#datsl').attr('pagina',pagina+1);
           
           $('#totalhist').html('Total: '+pagtotal);
            
           for(i=0;i<objt.content.length;i++)
           {
           
             if(objt.content[i].moneda=='USD')
             {
               var cantidad= formatonumero(objt.content[i].monto,2)+' '+objt.content[i].moneda;
               montUsd="";
             }
             else if(objt.content[i].moneda!=='DOP')
             {
               var cantidad= formatonumero(objt.content[i].monto,8)+' '+objt.content[i].moneda;
               montUsd="";
             }
             else
             {
               var cantidad= '';
               montUsd=formatonumero(objt.content[i].monto/objt.tasa,2)+' USD';
             }
             
             //estados
             var msdr="showtxinfo("+((parseFloat(pagina)*parseFloat(paglimite))+parseFloat(i))+")";
             
             if(objt.content[i].estado=='pendiente')
             {
               var estado='<i class="far fa-clock w3-text-grey w3-xlarge"></i>';
             }
             else if(objt.content[i].estado=='realizado')
             {
               var estado='<i class="fas fa-check-circle w3-text-green w3-xlarge"></i>';
             }
             else
             {
               var estado='<i class="fas fa-ban w3-text-red w3-xlarge"></i>';
             }
     
           
             if((i+1)==objt.content.length)
             {
                borderline='';
             }
             else
             {
                borderline='w3-border-bottom w3-border-light-grey';
             }   
                 
            var contanido ='<div class="w3-padding-8 w3-container w3-white w3-col s12" onclick="'+msdr+'" id="trst'+(pagina*paglimite+i+1)+'">';
                contanido +='<div class="w3-col s2 noselect">'+estado+'</div>';
                 contanido +='<div class="w3-col m10 l10 s10 '+borderline+'"><div class="w3-col s7 noselect w3-small w3-padding-bottom"><div class="w3-col s12 m12 l12"><b>'+objt.content[i].fecha+'</b></div><span> <img src="icon/'+objt[0][objt.content[i].tipo]+'.png" width="15px"> '+objt[0][objt.content[i].tipo]+': '+objt.content[i].direccion.substring(0, 7)+'...'+objt.content[i].direccion.substring(objt.content[i].direccion.length  -7, objt.content[i].direccion.length)+'</span></div>';
                 contanido +='<div class="w3-col s5 reajuste"><div class="w3-col s12 m12 l12"><span class="w3-right w3-padding-right" id="chmnd'+i+'">'+cantidad+'</span></div> <div class="w3-col s12 m12 l12"><span class="w3-right w3-padding-right">'+montUsd+'</span></div></div>';
                 
                 contanido +='<div class="w3-col s12 w3-border-top w3-border-light-grey w3-text-grey w3-padding-8" style="display: none;" id="tx'+(pagina*paglimite+i)+'"><small></small>';
                 hashID='hash'+(pagina*paglimite+i);
                 copytxid="copiarTexto('"+hashID+"','si')";
                 contanido +='<div class="w3-col s12 l12 m12"><b class="noselect"><small>Txid: </small></b><small style="user-select: all" id="'+hashID+'" onclick="'+copytxid+'" class="reajuste">'+objt.content[i].txid;
                 
                 hashlink="'"+objt.explorador[objt.content[i].tipo]+objt.content[i].txid+"'";
                 
                 contanido +=' <a onclick="abrirEnlaceExterno('+hashlink+')" target="_blank"><i class="far fa-arrow-alt-circle-right"></i></a></small></div>';
                 contanido +='</div></div>'; 
                 
             $("#trst"+(pagina*paglimite+i)).after(contanido);
           }
             $("#trst0").remove();
             $('#loaderspin').hide();
             //$('#histr').show();
                       
         }
         else
         {
             $('#loaderspin').hide();
             $("#trst0").show();
         } 
    }
    else
    {
        CerrarSesion();
    }
    
       
	    
  }
  
  
},
error: function (response)
{
   $("#notifigener").removeClass('w3-green').addClass('w3-red');
   $("#notifigener").html("<p>Verifique su conexión a internet</p>");
   $("#notifigener").show();
   setTimeout(function(){ $("#notifigener").hide(); }, 6000);
   $('#loadergif').hide();
}

});
}
historialcripto(1);
</script>

<script>
$(document).ready(function(){
 evitardupl=0;

 $(window).scroll(function(){
if(verarea()=='Historial')
{
  if($(window).scrollTop()+$(window).height()+76 >= $(document).height()){
   var pagactual = Number($('#datsl').attr('pagina'));
   var totalpag = Number($('#datsl').attr('pagtotal'));
   var maximoporpag = Number($('#datsl').attr('paglimite'));
   
if(pagactual>evitardupl)
{
   if(pagactual < (totalpag/maximoporpag)){
      historialcripto(pagactual+1);
      $('#loadergif').show();
      evitardupl=pagactual; 
   }
    
}
  }
}
 });

});
</script>   
<script> 
function showtxinfo(id)
{
    var x = document.getElementById('tx'+id).getAttribute("style");
    if (x.indexOf("display: none") == -1) {
        $('#tx'+id).attr("style","display: none");
        $('#chmnd'+id).html(formatNumber(monto/tasa,2)+' USD');
    } else { 
        $('#tx'+id).attr("style","display: block");
        $('#chmnd'+id).html(cantidad);
    }
}
</script>