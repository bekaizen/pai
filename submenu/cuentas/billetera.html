<div class="w3-col l12">

    <div class="w3-container w3-white w3-center">
    
    <div class="w3-margin-top w3-margin-bottom w3-col s12 w3-border w3-round w3-large w3-padding noselect">
        <span class="w3-center" id="monedaTitulo"></span> 
        <select class="w3-select w3-white w3-right w3-col s3 m2 l2 w3-border-0" style="outline:none" onchange="cambiarProtocolo(value)" id="protocolos"></select>
    </div> 
    
    
    <div id="qrbch" class="w3-col s12 m12 l12">&nbsp;</div>
    <div class="w3-col s12 m12 l12 w3-padding-top w3-text-grey"><i class="fa-solid fa-wallet w3-large w3-text-grey"></i> <span id="crytobalance">- -</span></div>   
    
    <div class="w3-margin-top w3-round w3-large w3-light-grey w3-round reajuste w3-col s12 m12 l12 pointer" onclick="copiarTexto('addrcript','si')">
      <span style="user-select: all" class="w3-col s11 m11 l11 w3-padding-top w3-padding-bottom" id='addrcript'></span> 
      <i class="fa-solid fa-copy w3-text-grey w3-col s1 m1 l1 w3-padding-top w3-padding-bottom"></i>
    </div>
    
    </div>
    
    <div class="w3-col s12 w3-white w3-container" id="visivilidadconversion" style="display:none">
        
    
    <div class="w3-leftbar w3-margin-bottom w3-margin-top"><span class="w3-margin-left">Conversión USD automática <span id="textoactivo"></span> </span> <i onclick="cambiarModoConversion()" id="OnOf" class="fa-solid fa-toggle-on w3-text-blue w3-xlarge w3-right w3-padding-right pointer"></i></div>
    
    <div id="seccionconversion" class="w3-col s12 m12 l12" style="display: block;">
      <div class="w3-col s4 m4 l4">
             <input class="w3-input w3-border w3-round" type="number" id="amoutmond" placeholder="" oninput="Cacularmoned(value)">
             <small class="w3-col s12" id='mndprec'></small>
      </div>
    
      <div class="w3-col s2 m2 l2 w3-center">
             <i class="fa-solid fa-right-long w3-text-grey fa-2x w3-padding-top"></i>
      </div>
    
      <div class="w3-col s6 l6 m6 w3-center">
             <div class="w3-col s12 w3-bottombar"> <span id="usdresult">0.00</span> USD </div>
             <div class="w3-col s12 w3-center">Comisión -<span id="feeporcent"></span>%  </div>
      </div>
      <small class="w3-left w3-text-grey w3-padding-top w3-padding-bottom">*Antes de transaccionar compruebe siempre  la comisión y conversión automática a USD.</small>
    </div>
      
    
    </div> 
     
     <!--<div class="w3-col s12 m12 l12 s12 w3-white w3-container w3-padding-4">
       <span class="w3-padding-bottom w3-col s12 m12 l12">Interactuar</span>
       <div class="w3-btn w3-col s5 m5 l5 w3-text-black w3-light-grey w3-border-light-grey w3-round w3-round-large pointer  w3-padding-4" onclick="OpenAcount('Historial')">
        <i class="fa-solid fa-clock-rotate-left pointer"></i> Historial
       </div>
       
       <div class="w3-btn w3-col s5 m5 l5 w3-text-black w3-light-grey w3-border-light-grey w3-round w3-round-large pointer  w3-padding-4 w3-margin-left w3-right" onclick="OpenOption('retirar')">
         <span><i class="fa-solid fa-arrow-right-from-bracket"></i> Retirar</span> 
       </div>
     </div>-->
     
    
    
    
     <!-- Confirmacion-->
    <div id="adddirect" class="w3-modal noselect">
      <div class="w3-display-middle  w3-white w3-round w3-round-xlarge w3-animate-fade w3-card-2 w3-col l10 m10 s10">
          
          <p class="w3-padding-32 w3-center reajuste w3-container">¿Desea generar una nueva dirección de <span id="monednomdr"></span>?</p>
          
          <div class="w3-col s6 m6 l6 w3-large w3-padding-16 w3-center w3-border-right w3-border-top w3-border-lightgrey" style="cursor:pointer" onclick="$('#adddirect').hide();">No</div>
          <div class="w3-col s6 m6 l6 w3-large w3-padding-16 w3-center  w3-border-top w3-text-blue w3-border-lightgrey" style="cursor:pointer" id="addaddrConfirm" onclick="">Si</div>
      </div>
    </div>
    <!-- //Confirmacion// -->
    </div>
    
    <script>
    //acciones de configuracion
    $('#amoutmond').attr('placeholder',Bsimbolo);
    $('#monedaTitulo').html(`<img src="icon/${Bsimbolo}.png" width="32px" onerror="this.onerror=null;this.src='https://paiexchange.com/appweb/icon/${Bsimbolo}.png'"> ${Bmoneda} (${Bsimbolo})`);
    $('#tradepar').html(Bsimbolo);
    
    
    protocolos=''; //bep20 trc20 erc20
    function cambiarProtocolo(value){
               
        
              for(i=0;i<protocolos.length;i++)
              { 
                 if(protocolos[i].id==value)
                 {
                     $('#qrbch').html(''); 
                     $('#qrbch').qrcode({render: 'image',size: 150,text: protocolos[i].cartera,mode: 0, ecLevel: 'M'}); 
                     $("#addrcript").html(protocolos[i].direcionSegura); 
                 }
              }
    }    
    </script>
    <script>
    function cambiarModoConversion()
    {
        seccion = $('#seccionconversion').attr('style');
        if(seccion=='display: block;')
        {
             conversion='no';
        }
        else
        {  
              conversion='si';
        }
        
    
    
    
    $.ajax({
    data: {'conversion':conversion, 'moneda':Bsimbolo},
    url: 'https://'+UrlAPI+'/AppConversionAutomatizada',
    type: 'post',
    success: function (response)
    {
      var objt=JSON.parse(response); 
      if(objt.resultado=='ok')
      {
        if(conversion=='si'){
            //mostar seccion
             $('#seccionconversion').show();
             //cambiar icono de on -off
             $('#OnOf').removeClass('fa-solid fa-toggle-off w3-text-grey').addClass('fa-solid fa-toggle-on w3-text-blue'); 
             //$('#textoactivo').html('activada');
        }
        else
        {
             //ocultar seccion
             $('#seccionconversion').hide();
              //cambiar icono de on -off
             $('#OnOf').removeClass('fa-solid fa-toggle-on w3-text-blue').addClass('fa-solid fa-toggle-off w3-text-grey');
             //$('#textoactivo').html('desactivada');
        }
      } 
    }
    })
    }
    </script>
    <script>
    
    //MenuAccion('fas fa-redo-alt',"GenerAdrrConfir('Binance Coin')");  
    EstatusBarColor('ffffff');
    $('#menusup').hide();
    
    
    function formatNumber(num) {
        num=parseFloat(num).toFixed(2);
        return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
    }
    function historialcripto(pagina)
    {
    var datos= {
    'tipo':Bmoneda,
    'codigo':Bsimbolo
    }
    
    $.ajax({
    data: datos,
    url: 'https://'+UrlAPI+'/AppHistorialDepositos',
    type: 'post',
    beforeSend: function ()
    {
       //$('#loadergif').show();
    },
    success: function (response)
    {
      $('#loadergif').hide(); 
      if(response=='')
      { 
    
         NotifiAlert("Problemas de comunicación con el servidor",'w3-red',5000);
      }
      else 
      {
      
         var objt=JSON.parse(response);
         if(objt.session=='true')
         {
              $("#addrcript").html(objt.wallets[0].direcionSegura);   
              $('#qrbch').qrcode({render: 'image',size: 150,text: objt.wallets[0].cartera,mode: 0, ecLevel: 'M'});
               
              $("#mndprec").html('1 '+Bsimbolo+' = '+formatonumero(JsonPrecios[Bsimbolo],Bdecimales)+' USD'); 
              fee=parseFloat(1-objt.fee);
              
              $("#crytobalance").html(objt.cryptoBalance);   
              $("#feeporcent").html(objt.fee*100);   
              
              if(objt.conversion=='no'){
                  //ocultar seccion
                  $('#seccionconversion').hide();
                  //cambiar icono de on -of
                  $('#OnOf').removeClass('fa-solid fa-toggle-on w3-text-blue').addClass('fa-solid fa-toggle-off w3-text-grey');
                  //$('#textoactivo').html('desactivada');
              }
              
              if(objt.aplica_conversion=='si'){
                  $('#visivilidadconversion').show();
              }
              
              protocolos=objt.wallets;
              for(i=0;i<objt.wallets.length;i++)
              { 
                 $('#protocolos').append('<option value="'+objt.wallets[i].id+'">'+objt.wallets[i].protocolo+'</option>');
              }
          }
          else
          {
            CerrarSesion();
          }
        
            
      }
    },
    error: function (response)
    {
       NotifiAlert("Problemas de comunicación con el servidor o verifique su internet",'w3-red',6000);
       $('#loadergif').hide();
    }
    
    });
    }
    historialcripto(1);
    </script>
    
    <script>                       
    function Cacularmoned(valor)
    {
        
      if(valor.indexOf(".")>-1)
      {
        var valor= valor.split('.'); var valor=valor[0]+'.'+valor[1].slice(0,8);
        $('#amoutmond').val(valor);
      }
      
      $("#usdresult").html(formatNumber(parseFloat((JsonPrecios[Bsimbolo]*valor)*fee),2));   
    }
    </script>
    <script>
    function Generardireccion(tipo)
    {
    
    var parametros={
    "tipo":tipo
    }
    
    $.ajax({
    data:parametros,
    url: 'https://'+UrlAPI+'/AppAddAddr',
    type: 'post',
    beforeSend: function ()
    {
       $('#loadergif').show();
    },
    success: function (response)
    {
      $('#loadergif').hide(); 
      if(response=='')
      { 
      
         NotifiAlert("No se ha obtenido resultados, compruebe su conexión",'w3-red',6000);
      }
      else 
      {
      
        var objt=JSON.parse(response);
        if(objt.session=='true')
        {
        
         $("#notifigener").removeClass('w3-green').removeClass('w3-red').addClass(objt.estado);
         $("#notifigener").html("<p>"+objt.mensaje+"</p>");
         $("#notifigener").show();
         setTimeout(function(){ $("#notifigener").hide(); }, 4000);
         
         if(objt.estado=='w3-green')
         {
              $("#addrcript").html(objt.DireccionSegura);   
              $('#qrbch').html('');
              //$('#qrbch').qrcode({render: 'image',size: 180,text: objt.Direccion,mode: 2, ecLevel: 'M',label:objt.Direccion.substring(0, 3)+'...'+objt.Direccion.substring(objt.Direccion.length-3, objt.Direccion.length),fontcolor: 'grey'});
               $('#qrbch').qrcode({render: 'image',size: 150,text: objt.Direccion,mode: 0, ecLevel: 'M'}); 
         }
          
        }
        else
        {
          CerrarSesion();
          OpenOption('login');
        }
        
           
            
      }
      
      
    },
    
    error: function (response)
    {
       NotifiAlert("Verifique su conexión a internet",'w3-red',6000);
       $('#loadergif').hide();
    }
    
    });
    }
    </script>
    <script>
    function GenerAdrrConfir(moneda)
    {
        $('#addaddrConfirm').attr('onclick',"Generardireccion('"+moneda+"');$('#adddirect').hide()");
        $('#monednomdr').html(moneda);
        $('#adddirect').show();
    }
    </script>