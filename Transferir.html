<script>
  $('#menusup').hide();
  EstatusBarColor('ffffff');
</script>
<div class="w3-col l8 w3-container w3-white w3-padding">

  <h5>Conversión</h5>
  <!-- este codigo no se ve pero de momento cumple una funcion-->
  <div class="w3-col s12 m12 l12 w3-container w3-white w3-round w3-round-large w3-padding w3-margin-top  w3-hide">
    <small class="w3-col s12 m12 l12">Desde</small>
    <i class="fa-solid fa-wallet w3-col l1 m1 s1 w3-large w3-text-grey w3-padding-top"></i>
    <select class="w3-input w3-border-0 w3-col s11 m11 l11 w3-white" style="outline:none" id="tipocartera"
      onchange="seleccionarCartera(value)">
      <option selected value="">Seleccione el origen</option>
      <option value="USD" selected>Cartera USD Swap</option>
      <option value="Cripto">Cartera de criptomonedas</option>
    </select>
  </div>
  <!-- este codigo no se ve pero de momento cumple una funcion-->

  <div class="w3-col s12 m12 l12 w3-container w3-white w3-round w3-round-large w3-margin-top w3-padding w3-border">
    <small class="w3-col s12 m12 l12">Seleccione la criptomoneda a convertir</small>
    <div class="w3-col s1 m1 l1 w3-padding-top"><img src="icon/cryptos.svg" style="width:30px" id="iconcript"></div>
    <div class="w3-col w3-border-0  w3-padding-top w3-round w3-round-large w3-container w3-col s11 m11 l11"
      onclick="if($('#tipocartera').val()!==''){$('#Dsplmoned').show()}else{NotifiAlert('Seleccione la cartera de origen','w3-red',4000);}">
      <div class="w3-col s11 m11 l11">
        <span class="w3-large w3-col s12 m12 l12" id="mondnam">Criptomoneda</span>
        <div class="w3-padding-top w3-col s12 m12 l12">
          <span class="w3-right">
            <i class="fa-solid fa-chart-simple w3-text-grey"></i> <span id='priceact'>0.00</span> USD
          </span>
        </div>
      </div>
      <div class="w3-col s1"><i class="fas fa-angle-down w3-padding-top w3-right"></i></div>
    </div>
  </div>

  <div class="w3-col s12 m12 l12 w3-container w3-white w3-round w3-round-large w3-margin-top w3-padding w3-border">
    <small class="w3-col s12 m12 l12">Dirección de billetera</small>
    <input type="text" class="w3-input w3-col s11 m11 l11 w3-border-0" id="addr"
      placeholder="Dirección de la billetera">
    <i class="fa-solid fa-qrcode w3-col l1 m1 s1 w3-large w3-text-grey w3-padding-top" id="scanaddr"></i>
  </div>

  <div class="w3-col s12 m12 l12 w3-container w3-white w3-round w3-round-large w3-margin-top w3-padding w3-border">
    <small class="w3-col s12 m12 l12">Cantidad</small>


    <div class="w3-col s4 m4 l4 w3-margin-bottom w3-left">
      <div class="w3-col l2 s2 m2"><i class="fas fa-dollar-sign w3-xlarge w3-text-blue-grey w3-padding-top"></i></div>
      <input class="w3-input w3-border-bottom w3-border-light-grey w3-col l10 s10 m10 w3-white" id="inpt2" type="text"
        inputmode="numeric" value="0" data='1' onfocus="$('#inpt2').attr('data', '1')"
        oninput="validpg(value,'inpt2',2);selectinput(value);" style="outline:none;text-align:right">
      <div class="w3-col l12 s12 m12" style="display:none" id='cvsm1'>
        <div class="w3-left"><small>Conversión</small></div>
      </div>
    </div>

    <div class="w3-col l2 s2 m2 w3-padding-right w3-padding-left w3-small w3-padding-top w3-center"><i
        class="fas fa-exchange-alt w3-large w3-text-blue-grey"></i></div>

    <div class="w3-col s6 m6 l6 w3-margin-bottom w3-right">
      <div class="w3-input w3-border-bottom w3-border-light-grey w3-col l4 s4 m4" id="codround"><span
          id="codecript">--</span></div>
      <input class="w3-input w3-col l8 s8 m8  w3-border-bottom w3-border-light-grey w3-white" id="inpt1" type="text"
        inputmode="numeric" onfocus="$('#inpt2').attr('data', '2');" value="0.0000"
        oninput="validpg(value,'inpt1',8);selectinput(value);" style="outline:none">
      <div class="w3-col l12 s12 m12" id='cvsm2'>
        <div class=""><small>Conversión del momento</small></div>
      </div>
    </div>


    <div class="w3-col s12 l12 m12 w3-padding-bottom w3-padding-top">
      <div class="w3-col l12 s12 m12 w3-small">
        <i class="fa-solid fa-cubes-stacked w3-text-blue w3-large"></i> Comisión de la red: - <b id='fee'>--</b>
      </div>
    </div>

  </div>

  <div class="w3-col l12 m12 s12 w3-margin-top w3-margin-bottom">
    <button class="w3-btn w3-blue w3-round-large w3-padding w3-col s12 w3-small" id="btnpg"
      onclick="buy_cripto($('#inpt2').val(),$('#addr').val(),$('#cripto').val());">Convertir y retirar</button>
  </div>

  <div id="datsl" class="w3-col l12 w3-margin-bottom"></div>
</div>

<script>
  $(document).ready(function () { $(".menu-lateral").load('submenu/menu-lateral.html') })
</script>
<div class="menu-lateral w3-col l4 w3-hide-small w3-hide-medium"></div>
<div class="w3-col s12 l12 w3-white w3-padding" style="margin-top:0px">
  <h5 class="w3-container noselect w3-margin-top" style="display:none" id="histr">Historial</h5>
  <div class="w3-center w3-container noselect" id="trst0" style="display:none">
    <h5>Sin transacciones</h5>
    <p>Aquí podrá ver las últimas transferencias realizadas desde su cuenta.</p>
  </div>
</div>






<!-- Confirma transferencia-->
<div id="transfconfirm" class="w3-modal noselect" style="display: none;">
  <div class="w3-display-middle  w3-white w3-round w3-round-xlarge w3-animate-fade  w3-col l5 m10 s10">
    <div class="w3-margin-bottom w3-container w3-margin-top">
      <div class="w3-col s12 m12 l12 w3-center">
        <i class="fa-solid fa-user-shield w3-xxxlarge w3-text-grey w3-col s12 m12 l12 w3-margin-bottom"></i>
        <p>Autenticación de doble factor.</p>
      </div>
      <small>Introduzca el código de doble factor</small>
      <input class="w3-input w3-border w3-border-light-grey w3-large w3-col s12 w3-margin-bottom" type="number"
        id='transfer2fa' placeholder="Código" style="outline:none">
      <bottom class="w3-btn w3-blue w3-center w3-col l12 m12 s12 w3-margin-bottom w3-round"
        onclick="buy_cripto($('#inpt2').val(),$('#addr').val(),$('#cripto').val())">Confirmar</bottom>
      <bottom class="w3-btn w3-light-grey w3-center w3-col l12 m12 s12 w3-round" onclick="$('#transfconfirm').hide()">
        Atrás</bottom>
    </div>

  </div>
</div>
<!-- //Confirma transferencia// -->



<!-- Monedas-->
<div id="Dsplmoned" class="w3-modal noselect">
  <div class="w3-display-middle  w3-white w3-round w3-round-xlarge w3-animate-fade  w3-col l5 m11 s11">

    <p class="reajuste w3-container w3-large w3-center">Seleccione una moneda de la lista</p>
    <div class="w3-center reajuste w3-border-top w3-border-light-grey" style="overflow-y:scroll;max-height:40vh">
      <div id="optio0"></div>
    </div>

    <div class="w3-col s12 m12 l12 w3-large w3-padding-16 w3-center w3-border-top w3-border-lightgrey w3-text-blue"
      style="cursor:pointer" onclick="$('#Dsplmoned').hide();">Cerrar</div>
  </div>
</div>
<!-- //monedas// -->

<!-- info-->
<div id="infoareacompr" class="w3-modal noselect" style="display:none">
  <div class="w3-display-middle w3-white w3-round w3-round-xlarge w3-animate-fade  w3-col l5 m10 s10">
    <div class="reajuste">
      <div class="w3-center w3-container">
        <p><b class="w3-large">Antes de realizar cualquier transacción tome en cuenta lo siguiente:</b></p>
      </div>

      <div class="w3-container" align="justfy" style="overflow-y:scroll;max-height:400px">

        <p>- Asegúrese de confirmar correctamente la dirección de destino de su transferencia antes aprobar el correo de
          confirmación, una vez
          confirmada la transacción en su correo electrónico ya no puede ser cancelada.</p>
        <p> - No garantizamos que en todas las ocasiones sus transacciones serán procesadas de forma inmediata.
          En algunos casos aislados podrían ocurrir demoras imprevistas.</p>
        <p>- Evite ser víctima de estafas, no envíe transacciones a plataformas o personas desconocidas.</p>
        <p> - Cuidado con los negocios que prometen exageradas ganancias como la minería, inversiones o aquellos que son
          parte de un esquema <b>Ponzi</b> o piramidal.</p>

        <p><b>- PAI Exchange</b> no se responsabiliza por el destino de su transacción, cualquier acción es tomada bajo
          su responsabilidad.</p>


        <center><input type="checkbox" id="checkarea" onclick="habilitaraceptar()"> Confirmo estos términos.</center>
        <br>
      </div>
    </div>

    <div id="infoacept"
      class="w3-col s12 m12 l12 w3-large w3-padding-16 w3-center  w3-border-top w3-border-lightgrey w3-text-blue"
      style="cursor:pointer" onclick="$('#checkarea').focus()">Aceptar</div>
  </div>
</div>
<!-- //info// -->

<script>
  criptomoneda = '';
  function seleccionarCartera(cartera) {

    if (cartera == 'USD') {
      $('#inpt2').attr('data', '1');
      $('#inpt1').attr('data', '2');
      $('#inpt2').val(formatonumero(usdSaldo - feesent[codigo], 2));
      selectinput(formatonumero(usdSaldo - feesent[codigo], 2));
    }
    else {
      $('#inpt1').attr('data', '1');
      $('#inpt2').attr('data', '2');
      changemoneda('{ "name":"' + criptomoneda + '", "code":"' + codigo + '", "decimal":"' + decimal + '","PrecMax":"' + PrecMax + '"}', 'automatico', '');
      selectinput(0);
    }

  }    
</script>
<script>
  function habilitaraceptar() {
    var accions = "$('#infoareacompr').hide();localStorage.setItem('infotransferir', 'aceptado');";
    $('#infoacept').attr('onclick', accions)
  }
  if (localStorage.getItem('infotransferir') !== 'aceptado') {
    $('#infoareacompr').show();
  }
</script>


<script>
  $(document).ready(function () {
    document.addEventListener("deviceready", onDeviceReady, false);
  });

  function onDeviceReady() {
    $('#scanaddr').click(function () {
      cordova.plugins.barcodeScanner.scan(
        function (result) {

          var direccion_obtenida = result.text; //'tron:TRZvPtQt8GGpHZy81iCuEyMZWTXJzFDHos?amount=1';
          if (direccion_obtenida.indexOf(":") > -1) {
            var dividir = direccion_obtenida.split(":");
            moneda_obtenida = dividir[0];

            //buscando la moneda correta y seleccionarla
            for (i = 0; i < MonedasDisponibles.length; i++) {

              if (MonedasDisponibles[i].name.toLowerCase().indexOf(moneda_obtenida.toLowerCase()) > -1) {
                changemoneda('{ "name":"' + MonedasDisponibles[i].name + '", "code":"' + MonedasDisponibles[i].code + '", "decimal":"' + MonedasDisponibles[i].decimal + '","PrecMax":"' + MonedasDisponibles[i].PrecMax + '"}', '', '');
                i = MonedasDisponibles.length; //fin bucle
              }

            }
            if (dividir[1].indexOf("?amount=")) {
              dividirB = dividir[1].split("?amount=");
              direccion_obtenida = dividirB[0];
              monto_obtenido = dividirB[1];

              $('#inpt1').val(monto_obtenido);
              $('#inpt2').attr('data', '2');
              $('#inpt1').attr('data', '1');
              selectinput();
            }
            $('#addr').val(direccion_obtenida);
            //console.log('Direccion='+direccion_obtenida);
            //console.log('Moneda='+moneda_obtenida);
          }
          else {
            $('#addr').val(direccion_obtenida);
          }





        },
        function (error) {
          alert("Falló el escaneo " + error);
        },
        {
          disableSuccessBeep: true
        });
    }
    );
  }
</script>
<script>
  function validpg(value, inpt, decimal) {

    value = value.replace(/[^0-9\.,]/g, '');
    if (/[.]/.test(value)) {
      div = value.split('.');
      value = div[0] + '.' + div[1].slice(0, decimal);
    }
    $('#' + inpt).val(value);
  }
</script>



<script>
  function formatNumber(num, decimales) {
    num = parseFloat(num).toFixed(decimales);
    if (decimales > 2) {
      return num;
    }
    else {
      return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
    }
  }

  feesent = '';
  pricenet = '';
  decimal = '';

  function changemoneda(val, metodo) {
    var pack = JSON.parse(val);
    value = pack.name;
    decimal = pack.decimal;
    criptomoneda = pack.name;
    codigo = pack.code;
    PrecMax = pack.PrecMax;
    Fee = feesent[codigo];
    pricenet = formatNumber(JsonPrecios[codigo], PrecMax).replace(/[^0-9\.]/g, '');

    $('#iconcript').attr('src', 'icon/' + codigo + '.png').attr('onerror', "this.onerror=null;this.src='https://paiexchange.com/appweb/icon/" + codigo + ".png'");
    $('#codecript').html(codigo);
    $('#priceact').html(formatNumber(JsonPrecios[codigo], PrecMax));
    $('#mondnam').html(criptomoneda);
    $('#fee').html(Fee + ' USD')


    if (metodo !== 'automatico') {
      $('#Dsplmoned').hide();

      $('#inpt2').attr('data', '1');
      $('#inpt1').attr('data', '2');
      if (usdSaldo > Fee) {
        $('#inpt2').val(formatonumero(usdSaldo - Fee, 2));
      }
      else {
        $('#inpt2').val('0.00');
      }


    }

    $('.far.fa-dot-circle.w3-padding-top.w3-text-grey').removeClass("far fa-dot-circle w3-padding-top w3-text-grey").addClass("far fa-circle w3-padding-top w3-text-grey");
    $('#selec' + codigo).removeClass("far fa-circle w3-padding-top w3-text-grey").addClass("far fa-dot-circle w3-padding-top w3-text-grey");
    selectinput();

  }
  function selectinput(value) {
    if ($('#inpt2').attr('data') == 1) {
      usdtocripto($("#inpt2").val());
      $('#cvsm1').hide();
      $('#cvsm2').show();
    }
    else {
      criptotousd($("#inpt1").val());
      $('#cvsm2').hide();
      $('#cvsm1').show();
    }
  }


  function criptotousd(value) {

    if (value !== '' && value > 0) {
      var value = (parseFloat(value) * parseFloat(pricenet)) + '';
      if (value.indexOf(".") > -1) {
        var value = value.split('.'); var value = value[0] + '.' + value[1].slice(0, 2);
      }

      //cripto convert  
      $('#inpt2').val(formatNumber(value, 2));

      //DOP CONVERT 
      var dop = parseFloat(value) * parseFloat(JsonPrecios.DOP) + '';
      if (dop.indexOf(".") > -1) {
        var dop = dop.split('.'); var dop = dop[0] + '.' + dop[1].slice(0, 2);
      }


    }
    else {
      $('#inpt2').val('0.00');
    }

  }

  function usdtocripto(value) {
    var valueX = value.replace(/[^0-9\.]/g, '');

    if (valueX !== '' && valueX > 0 && pricenet > 0) {
      var valueX = (parseFloat(valueX) / parseFloat(pricenet)) + '';
      /*if(value<valor.split('.')[0])
      {
          value='0.00000000';
      }
      else
      {
         value=valor; 
      }*/
      if (valueX.indexOf("-") > -1) {
        valueX = '0.00000000'; // evitar numeros notacion cientifica 4.34782609e-7
      }
      if (valueX.indexOf(".") > -1) {
        var valueX = valueX.split('.'); var valueX = valueX[0] + '.' + valueX[1].slice(0, decimal);
      }


      //cripto convert  
      $('#inpt1').val(valueX, 2);

      //DOP CONVERT 
      var dop = parseFloat(valueX) * parseFloat(JsonPrecios.DOP) + '';
      if (dop.indexOf(".") > -1) {
        var dop = dop.split('.'); var dop = dop[0] + '.' + dop[1].slice(0, 2);
      }


    }
    else {
      $('#inpt1').val('0.' + '0'.repeat(decimal));
    }

  }

</script>

<script>

  function buy_cripto(monto, direccion, cripto) {
    monto = monto.replace(/[^0-9\.]/g, '');
    codigoFa = $('#transfer2fa').val();

    if (monto > 0 && monto !== '' && direccion !== '' && direccion.length > 20) {

      if ($('#inpt2').attr('data') == 2) {
        var cantidad = $('#inpt1').val();
      }
      else {
        var cantidad = 0;
      }

      if (Es2fa == 'true' && $('#transfconfirm').attr('style') == 'display: none;') {
        $('#transfconfirm').show(); //muestra solicitud 2fa
      }
      else if (Es2fa == 'true' && codigoFa.length < 6) {
        NotifiAlert('Complete el código de doble factor', 'w3-red', 6000);
      }
      else {

        var parametros = {
          "monto": monto,
          "direccion": direccion,
          "moneda": criptomoneda,
          "codigo": codigo,
          "cantidad": cantidad,
          "2fa": codigoFa,
          "tipocartera": $('#tipocartera').val()

        };
        $.ajax({
          data: parametros,
          url: 'https://' + UrlAPI + '/AppBuyCripto',
          type: 'post',
          beforeSend: function () {
            $("#loadergif").show();
            $('#transfer2fa').val(''); //2fa codigo reset
          },
          success: function (response) {

            $('#loadergif').hide();
            if (response == '') {
              NotifiAlert('No se ha obtenido resultados, compruebe su conexión', 'w3-red', 6000);
            }
            else {

              var objt = JSON.parse(response);
              if (objt.session == 'true') {

                //resultado
                if (objt.estado == 'ok') {
                  NotifiAlert('Se está procesando su transacción', 'w3-green', 6000);
                  $('#transfconfirm').hide();
                  OpenOption('Transferir');
                }
                else if (objt.estado == 'confirmacion') {
                  NotifiAlert(objt.mensaje, 'w3-red', 9000);
                  OpenOption('Transferir');
                }
                else {
                  NotifiAlert(objt.mensaje, 'w3-red', 6000);
                  //OpenOption('Compras');
                }

              }
              else {
                CerrarSesion();
              }


            }
          },

          error: function (response) {
            NotifiAlert('Problemas de comunicación', 'w3-red', 6000);
            $('#loadergif').hide();
          }

        });
      }

    }
    else {

      if (monto <= 0) {
        $("#inpt2").focus();
      }
      else {
        if (direccion == '' || direccion.length < 20) {
          $("#addr").focus();
        }
      }

    }

  } 
</script>


<script>
  Es2fa = '';
  cryptobalances = '';
  usdSaldo = '';
  MonedasDisponibles = '';
  function historialVentas(pagina) {


    $.ajax({
      url: 'https://' + UrlAPI + '/AppHistorialVentas',
      type: 'post',
      data: { pagina: pagina },
      beforeSend: function () {
        //$('#loadergif').show();
        //$('#loaderspin').show();   
      },
      success: function (response) {
        $('#loadergif').hide();
        if (response == '') {
          NotifiAlert('No se ha obtenido resultados, compruebe su conexión', 'w3-red', 6000);
        }
        else {

          var objt = JSON.parse(response);
          if (objt.session == 'true') {

            //Dinero
            //$('#inpt2').val(objt.dinero);
            //selectinput(); 
            usdSaldo = objt.dinero;

            //paginacion
            pagtotal = objt.paginas.total;
            paglimite = objt.paginas.maximo;
            pagina = pagina - 1;


            $('#datsl').attr('pagtotal', pagtotal);
            $('#datsl').attr('paglimite', paglimite);
            $('#datsl').attr('pagina', pagina + 1);

            //Val Variable feesent
            cryptobalances = objt.balances;

            feesent = objt.fee;
            if (pagina == 0) {
              //changemoneda('{ "name":"Bitcoin", "code":"BTC", "decimal":"8" , "PrecMax":"2"}');

              $('#inpt2').val(formatonumero(usdSaldo, 2));
              //habilitar solicitud 2fa 
              Es2fa = objt['2fa'];
              MonedasDisponibles = objt.monedas;

              //Agregando monedas disponibles
              for (let i = 0; i < objt.monedas.length; i++) {
                let datos = JSON.stringify(objt.monedas[i]);
                let optimond = `
            <div class="w3-container w3-padding-8 w3-border-bottom w3-border-light-grey" id="optio${i + 1}" data='${datos}' onclick="changemoneda($('#optio${i + 1}').attr('data'))" style="cursor:pointer"> 
             <div class="w3-col s11">
               <img onerror="this.onerror=null;this.src='https://paiexchange.com/appweb/icon/${objt.monedas[i].code}.png'" src="icon/${objt.monedas[i].code}.png" style="width:36px" class="w3-left">
               <label class="w3-large w3-left w3-padding">${objt.monedas[i].name}</label>
             </div> 
            <div class="w3-col s1 w3-padding-top">
              <i id="selec${objt.monedas[i].code}" class="far fa-circle w3-padding-top w3-text-grey"></i>
           </div>
            </div>`;
                $(`#optio${i}`).after(optimond);
              }


            }

            //transacciones
            if (objt.content.length > 0) {


              for (i = 0; i < objt.content.length; i++) {

                msdr = '';
                //estados
                if (objt.content[i].statuss == 'confirmacion') {
                  var estado = '<i class="fa-solid fa-envelope-circle-check w3-text-yellow w3-xlarge"></i>';
                }
                else if (objt.content[i].estado == 'enviado') {
                  var estado = '<i class="fas fa-check-circle w3-text-green w3-xlarge"></i>';
                  var msdr = "showtxinfo(" + ((parseFloat(pagina) * parseFloat(paglimite)) + parseFloat(i)) + "," + objt.content[i].monto + "," + objt.tasa + ",'" + objt.content[i].cantidad + " " + objt.content[i].moneda + "')";
                }
                else if (objt.content[i].estado == 'pendiente') {
                  var estado = '<i class="far fa-clock w3-text-grey w3-xlarge"></i>';
                }
                else if (objt.content[i].progreso == 'proceso') {
                  var estado = '<i class="far fa-clock w3-text-grey w3-xlarge"></i>';
                }
                else if (objt.content[i].progreso == 'fallido') {
                  var estado = '<i class="fa-solid fa-circle-exclamation w3-text-red w3-xlarge"></i>';
                }
                else {
                  var estado = '<i class="fas fa-ban w3-text-red w3-xlarge"></i>';
                }


                montoCry = formatNumber(objt.content[i].monto / objt.tasa, 2) + ' USD';
                if (objt.content[i].cantidad !== '~' && objt.content[i].estado !== 'enviado') {
                  montoCry = objt.content[i].cantidad + ' ' + objt.content[i].moneda;
                }

                if ((i + 1) == objt.content.length) {
                  borderline = '';
                }
                else {
                  borderline = 'w3-border-bottom w3-border-light-grey';
                }

                var contanido = '<div class="w3-padding-8 w3-container w3-white w3-col s12" onclick="' + msdr + '" id="trst' + ((parseFloat(pagina) * parseFloat(paglimite)) + parseFloat(i) + parseFloat(1)) + '">';
                contanido += '<div class="w3-col s2 noselect">' + estado + '</div>';
                contanido += '<div class="w3-col m10 l10 s10 ' + borderline + '"><div class="w3-col s7 noselect w3-small w3-padding-bottom"><div class="w3-col s12 m12 l12"><span><img width="15px" src="icon/' + objt.content[i].moneda + '.png"> ' + objt.content[i].nombre + '</span></div><span> Para: ' + objt.content[i].direccion + '</span></div>';
                contanido += '<div class="w3-col s5 reajuste"><div class="w3-col m12 l12 s12"><span class="w3-right w3-padding-right" id="chmnd' + (pagina * paglimite + i) + '">' + montoCry + '</span></div><div class="w3-col m12 l12 s12"><small class="w3-right w3-padding-right">' + objt.content[i].fecha + '</small></div></div>';

                contanido += '<div class="w3-col s12 w3-border-top w3-border-light-grey w3-text-grey w3-padding-8" style="display: block;" id="tx' + (pagina * paglimite + i) + '"><small></small>';

                for (e = 0; e < objt.content[i].txid.split(',').length; e++) {
                  txid = objt.content[i].txid.split(',');
                  mgr = '';
                  NumeroHash = '';

                  if (e > 0) {
                    mgr = 'w3-margin-bottom';
                    NumeroHash = (e + 1);
                  }

                  hashID = 'hash' + (pagina * paglimite + i);
                  copytxid = "copiarTexto('" + hashID + "','si')";

                  hashlink = "'" + objt.explorador[objt.content[i].moneda] + txid[e] + "'";
                  contanido += '<div class="' + mgr + 'w3-col s12 l12 m12"><b class="noselect"><small>Hash' + NumeroHash + ': </small></b><small style="user-select: all" id="' + hashID + '" onclick="' + copytxid + '" class="reajuste">' + txid[e];
                  contanido += ' <a onclick="abrirEnlaceExterno(' + hashlink + ')"><i class="far fa-arrow-alt-circle-right"></i></a></small></div>';
                }

                contanido += '</div></div></div>';

                $("#trst" + ((parseFloat(pagina) * parseFloat(paglimite)) + parseFloat(i))).after(contanido);
              }
              $("#trst0").remove();
              $('#loaderspin').hide();
              $('#histr').show();

            }
            else {
              $('#loaderspin').hide();
              $("#trst0").show();
            }

          }
          else {
            CerrarSesion();
          }



        }


      },

      error: function (response) {
        NotifiAlert('Verifique su conexión a internet', 'w3-red', 6000);
        $('#loadergif').hide();
        $('#loaderspin').hide();
      }

    });
  }
  historialVentas(1);

</script>

<script>
  $(document).ready(function () {
    evitardupl = 0;

    $(window).scroll(function () {
      if (verarea() == 'Transferir') {
        if ($(window).scrollTop() + $(window).height() + 76 >= $(document).height()) {
          var pagactual = Number($('#datsl').attr('pagina'));
          var totalpag = Number($('#datsl').attr('pagtotal'));
          var maximoporpag = Number($('#datsl').attr('paglimite'));

          if (pagactual > evitardupl) {
            if (pagactual < (totalpag / maximoporpag)) {
              historialVentas((pagactual + 1));
              $('#loadergif').show();
              //window.scrollBy(0, -1);
              evitardupl = pagactual;
            }

          }
        }
      }
    });

  });
</script>
<script>
  var storedComprIntervalId = sessionStorage.getItem('comprIntervalId');
  if (storedComprIntervalId) {
    clearInterval(parseInt(storedComprIntervalId));
  }
  var Compr = setInterval(function () {
    console.log('transferirInterval');
    var namepath = window.location.pathname.split('/');
    if (namepath[(namepath.length) - 1] == 'Transferir' && criptomoneda !== "") {
      changemoneda('{ "name":"' + criptomoneda + '", "code":"' + codigo + '", "decimal":"' + decimal + '","PrecMax":"' + PrecMax + '"}', 'automatico', '');
    }
  }, 15000);
  sessionStorage.setItem('comprIntervalId', Compr);
</script>
<script>
  function showtxinfo(id, monto, tasa, cantidad) {
    var x = document.getElementById('tx' + id).getAttribute("style");
    if (x.indexOf("display: none") == -1) {
      $('#tx' + id).attr("style", "display: none");
      $('#chmnd' + id).html(formatNumber(monto / tasa, 2) + ' USD');
    } else {
      $('#tx' + id).attr("style", "display: block");
      $('#chmnd' + id).html(cantidad);
    }
  }
</script>