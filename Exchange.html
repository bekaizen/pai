<div class="w3-padding-bottom w3-margin-bottom">
  
 

 
    <div class="w3-white w3-container w3-col s11 m12 l12 w3-margin-left w3-margin-top w3-text-blue-grey w3-margin-bottom" style="max-width:97.2%">
     
     
     <h6 class="w3-col l1 s3 w3-border w3-border-light-blue w3-hover-light-grey w3-round w3-container w3-padding-8 w3-center" style="cursor:pointer">
         <span class="w3-col l12 s12"><b>BTCDOP</b></span><small class="w3-text-green w3-col s12 l12 m12" id="precspr">376,935.00</small>
     </h6>
     
      <h6 class="w3-col l1 s3 w3-border w3-border-light-grey w3-light-grey w3-round w3-container w3-padding-8 w3-center w3-margin-left w3-margin-right" style="cursor:pointer">
         <span class="w3-col l12 s12"><b>BTCUSD</b></span><small class="w3-text-grey w3-col s12 l12 m12">_  _</small>
     </h6> 
     
     <h6 class="w3-col l1 s3 w3-border w3-border-light-grey w3-light-grey w3-round w3-container w3-padding-8 w3-left w3-center" style="cursor:pointer">
         <span class="w3-col l12 s12"><b>BTCUSDT</b></span><small class="w3-text-grey w3-col s12 l12 m12">_  _</small>
     </h6> 
     
     <h6 class="w3-col l4 s4 w3-center w3-padding-8"><small class="w3-col l12 s12 m12 w3-text-grey">Volumen 24H</small>1,500,000.78</h6>
     
     <div class="w3-col l4 s8  w3-container w3-right">
        <div class="w3-right w3-margin-top w3-padding-top w3-padding-bottom">
           <button class="w3-btn w3-white w3-col l6 s6  w3-border w3-border-light-grey w3-round">Transferir</button>
           <button class="w3-btn w3-margin-left w3-white w3-col l5 s5  w3-border w3-border-light-grey w3-round">Retirar</button>
        </div>    
     </div>
    </div>
        
    <div class="w3-container w3-col l8 s12">	
    
       <div class="w3-center w3-white w3-text-blue-grey w3-col l12">
            <iframe src="/.test/chartframe.html" height="350px" width="100%" frameborder="0" scrolling="no"></iframe>      
       </div>
    
      <div class="w3-margin-top w3-white w3-text-blue-grey w3-col l12 s12" style=""> 
    
          <div class="w3-col l12 m12 s12">
                        <div class="w3-col l6 m6 s6 w3-margin-top w3-margin-bottom w3-container">
                           <small class="w3-margin-bottom">Disponible: <?=$dop_disponible;?> DOP</small>
                           <input type="number" class="w3-input w3-margin-top w3-border" placeholder="Precio" id="precompr">
                           <input type="number" class="w3-input w3-margin-top w3-border" placeholder="BTC"  id="comprcant" oninput="$('#comprcant').val(validpg(value,8));$('#equivcompr').html(formatNumber(validpg(value*$('#precompr').val(),2)),2);$('#vol').val(validpg(value*$('#precompr').val(),2))">
                           <input type="range"  class="w3-margin-top w3-margin-bottom w3-col l12" id="vol" oninput="$('#equivcompr').html(formatNumber(value,2));$('#comprcant').val(validpg(value/$('#precompr').val(),8))" value="0" min="0.00" max="<?=$dop_disponible;?>">
                           <div class="w3-margin-top">Equivalente: <span id="equivcompr">0</span></div>
                           
                           <button class="w3-btn w3-green w3-col l12 w3-margin-top w3-round" onclick="Trade('compra',$('#precompr').val(),$('#comprcant').val())">Comprar</button>
                        </div>
                        
                        
                        
                        <div class="w3-col l6 m6 s6 w3-margin-top w3-margin-bottom w3-container">
                           <small class="w3-margin-bottom"><?=$btc_disponible;?> BTC</small>
                           <input type="number" class="w3-input w3-margin-top w3-border" placeholder="Precio" id="prevent">
                           <input type="number" class="w3-input w3-margin-top w3-border" placeholder="BTC" id="ventcant" oninput="$('#ventcant').val(validpg(value,8));$('#equivvent').html(formatNumber(validpg(value*$('#prevent').val(),2)),2);$('#volvent').val(validpg(value,8))">
                           <input type="range"  class="w3-margin-top w3-margin-bottom w3-col l12" id="volvent" oninput="$('#equivvent').html(formatNumber(validpg(value*$('#prevent').val(),2)),2);$('#ventcant').val(validpg(value,8))" value="0.00000000" min="0" step="0.00000001" max="<?=$btc_disponible;?>">
                           <div class="w3-margin-top">Equivalente:  <span id="equivvent">0</span></div>
                           
                           <button class="w3-btn w3-red w3-col l12 w3-margin-top w3-round" onclick="Trade('venta',$('#prevent').val(),$('#ventcant').val())">Vender</button>
                        </div>
          </div>
    
      </div>
    
    </div>
    
    
    <div class="w3-col m12 l4 s12">
    <div class="w3-col l11 s11 w3-white w3-text-blue-grey  w3-margin-left">
       <div class="w3-container w3-padding-8 w3-border-bottom w3-border-light-grey"><b>Libro de ordenes</b></div> 
    
           
    <div class="w3-margin-top w3-margin-bottom">
    <div class="w3-container" style="height:269px;overflow-y:scroll" id="Areaventas">   
    
    </div> 
    
    
    <div class="w3-col l12 w3-padding-16 w3-white w3-container">
    <div class="w3-col l3 s3 m3 w3-left"><b>Precio</b></div> 
    <div class="w3-col l6 m s6 w3-center w3-text-green"> <i class="fa fa-sort-up"></i> <span id='bookprice' onclick=""><?=number_format(377000-$i,2,'.',',')?></span> </div>
    <div class="w3-col l3 s3 m3 w3-right"> <b class="w3-right">Cantidad</b></div></div>
    
    
    
    <div class="w3-container w3-margin-top" style="height:269px;overflow-y:scroll" id="Areacompras"> 
    
    </div> 
    
    </div>   
    </div>
    </div> 
    
    
    <div class="w3-white   w3-reponsive w3-col s11  m12 l12 w3-margin-left w3-margin-top w3-text-blue-grey w3-margin-bottom" style="max-width:97.2%">
        
    <div class="w3-bar w3-white w3-border-bottom w3-border-light-grey">
      <button class="w3-bar-item w3-btn w3-white w3-border-right w3-border-light-grey" onclick="openCity('London')">Ordenes activas</button>
      <button class="w3-bar-item w3-btn w3-white w3-border-right w3-border-light-grey" onclick="openCity('Paris')">Historial</button>
    </div>
    
    <div id="London" class="w3-container city w3-col l12 m12">
      <div class="w3-col l12 m12 w3-responsive">
        
        <table class="w3-table">
        <tr>
         <th>Fecha</th>
         <th>Tipo</th>
         <th>Cantidad</th>
         <th>Precio</th>
         <th>Valor BTC</th>
         <th>Ejecutado</th>
        <th>Acciones</th>
       </tr>
       
       <tr>
        <td>12-Abr-20-6:10 PM</td>
        <td class="w3-text-green">Compra</td>
        <td>34,000.01</td>
        <td>345,000.03</td>
        <td>0.09000000</td>
        <td>0.08000000</td>
        <td>x</td>
       </tr>
          
        <tr>
        <td>12-Abr-20-6:10 PM</td>
        <td class="w3-text-red">Venta</td>
        <td>34,000.01</td>
        <td>345,000.03</td>
        <td>0.09000000</td>
        <td>0.08000000</td>
        <td>x</td>
       </tr>
       </table>
          
         
          
      </div>
    </div>
    
    <div id="Paris" class="w3-container city" style="display:none">
          <table class="w3-table">
        <tr>
         <th>Fecha</th>
         <th>Tipo</th>
         <th>Cantidad</th>
         <th>Precio</th>
         <th>Valor BTC</th>
         <th>Ejecutado</th>
        <th>Observaciones</th>
       </tr>
       </table>
      <p class="w3-center w3-padding-8">No hay transacciones</p> 
    </div>
    
    </div>
    
    
    </div>	
    
    <script>
    function Trade(tipo,precio,cantidad){
    
    if(tipo!=='' || precio!=='' || cantidad!=='')
    {
    
    var parametros = {
    "tipo" : tipo,
    "precio" : precio,
    "cantidad" : cantidad,
    "mercado":"DOP",
    "moneda":"BTC"
    };
    url='trade_orden_compra';
    if(tipo=='venta')
    {
        url='trade_orden_venta'
    }
    $.ajax({
    data: parametros,
    url: url,
    type: 'post',
    beforeSend: function () {
    $("#loadergif").show();
    
    },
    success: function (response)
    {
      
        $("#loadergif").hide();
        obj = JSON.parse(response);
        if(obj.estado=='ok')
         {
           $("#notifigener").removeClass('w3-red').addClass('w3-green');
           $("#notifigener").html('<p>'+obj.mensaje+'</p>');
           $("#notifigener").show();
           setTimeout(function(){ $("#notifigener").hide(); }, 6000);
           orderBook();
         }
         else
         {
           $("#notifigener").removeClass('w3-green').addClass('w3-red');
           $("#notifigener").html('<p>'+obj.mensaje+'</p>');
           $("#notifigener").show();
           setTimeout(function(){ $("#notifigener").hide(); }, 6000);
         }
      
      
    
    },
    
    error: function (response) {
    $("#notifigener").removeClass('w3-green').addClass('w3-red');
    $("#notifigener").html('<p>Sin conexión a intertet</p>');
    $("#notifigener").show();
    setTimeout(function(){ $("#notifigener").hide(); }, 6000);
    }
    
    });
    
    }
    else
    
    {
      //$("#alertpg").html('Completa los campos requeridos.'); 
    }
    
    } 
    </script>
    
    <script>
    function validpg(value,decimal)
    {
    
    value=value+''.replace(/[^0-9\.,]/g,'');
    if(/[.]/.test(value))
    {
     div=value.split('.');
     value=div[0]+'.'+div[1].slice(0,decimal);  
    }
    return value;
    }
    
    function formatNumber (num,decimales) {
        
            return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
      
    }
    </script>
    
    
    <style>
        .w3-container::-webkit-scrollbar {
        width: 8px;     /* Tamaño del scroll en vertical */
        height: 8px;    /* Tamaño del scroll en horizontal */
        display: block;  /* Ocultar scroll */
    }
    /* Ponemos un color de fondo y redondeamos las esquinas del thumb */
    .w3-container::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 4px;
    }
    
    /* Cambiamos el fondo y agregamos una sombra cuando esté en hover */
    .w3-container::-webkit-scrollbar-thumb:hover {
        background: #b3b3b3;
        box-shadow: 0 0 2px 1px rgba(0, 0, 0, 0.2);
    }
    
    /* Cambiamos el fondo cuando esté en active */
    .w3-container::-webkit-scrollbar-thumb:active {
        background-color: #999999;
    }
    /* Ponemos un color de fondo y redondeamos las esquinas del track */
    .w3-container::-webkit-scrollbar-track {
        background: #e1e1e1;
        border-radius: 4px;
    }
    
    /* Cambiamos el fondo cuando esté en active o hover */
    .w3-container::-webkit-scrollbar-track:hover,
    .w3-container::-webkit-scrollbar-track:active {
      background: #d4d4d4;
    }
    </style>
    
    <script>
    function openCity(cityName) {
      var i;
      var x = document.getElementsByClassName("city");
      for (i = 0; i < x.length; i++) {
        x[i].style.display = "none";  
      }
      document.getElementById(cityName).style.display = "block";  
    }
    </script>
    <script>
    setInterval(function(){ 
        rand=Math.floor(Math.random() * (obj.ventas.length - (obj.ventas.length-10) + 1) ) + (obj.ventas.length-10);
        $('#vent'+rand).addClass("w3-light-grey");
        $('#bookprice,#precspr').html($('#precve'+rand).html()); 
         setTimeout(function(){ $('#vent'+rand).hide();  }, 500);
        setTimeout(function(){ $('#vent'+rand).show().removeClass("w3-light-grey");  }, 1000);
    
        
    }, 2000);
    
    
    setInterval(function(){ 
        
         rands=Math.floor(Math.random() * (10 - 0 + 1) ) + 0;
        $('#compr'+rands).addClass("w3-light-grey"); 
         setTimeout(function(){ $('#compr'+rands).hide();  }, 500);
        setTimeout(function(){ $('#compr'+rands).show().removeClass("w3-light-grey");  }, 1000);
    
        
    }, 2000);
    </script>
    
    
    <script>
    function orderBook()
    {
        
    
    $.ajax({
    url: 'orden_book',
    type: 'post',
    beforeSend: function () {
    //$("#loadergif").show();
    
    },
    success: function (response)
    {
      
       // $("#loadergif").hide();
        obj = JSON.parse(response);
        ideses="'#precompr,#prevent'";
     
        ventas='';
        for(i=0;i<obj.ventas.length;i++)
        {
            
            ventas+='<div class="w3-col l12 w3-hover-light-grey w3-hover-text-grey" id="vent'+i+'" onclick="$('+ideses+').val('+obj.ventas[i].precio+')" style="padding-top:4px;padding-bottom:4px;display:block">';
            ventas+='<div class="w3-col l4 s4 m4 w3-text-red" id="precve'+i+'">'+formatNumber(validpg(obj.ventas[i].precio,2),2)+'</div>';
            ventas+='<div class="w3-col l4 s4 m4"><div class=" w3-center">'+validpg(obj.ventas[i].cantidad,8)+'</div></div>';
            ventas+='<div class="w3-col l4 s4 m4"><div class="w3-right">'+formatNumber(validpg(obj.ventas[i].cantidad*obj.ventas[i].precio,2),2)+'</div></div></div>';
           
            
        }
        $('#Areaventas').html(ventas); 
    
        var objDiv = document.getElementById("Areaventas");
        objDiv.scrollTop = objDiv.scrollHeight;
        
        compras='';
        for(i=0;i<obj.compras.length;i++)
        {
            
            compras+='<div class="w3-col l12 w3-hover-light-grey w3-hover-text-grey" id="compr'+i+'" onclick="$('+ideses+').val('+obj.compras[i].precio+')" style="padding-top:4px;padding-bottom:4px;display:block">';
            compras+='<div class="w3-col l4 s4 m4 w3-text-green" id="precve'+i+'">'+formatNumber(validpg(obj.compras[i].precio,2),2)+'</div>';
            compras+='<div class="w3-col l4 s4 m4"><div class=" w3-center">'+validpg(obj.compras[i].cantidad,8)+'</div></div>';
            compras+='<div class="w3-col l4 s4 m4"><div class="w3-right">'+formatNumber(validpg(obj.compras[i].cantidad*obj.compras[i].precio,2),2)+'</div></div></div>';
           
            
        }
        $('#Areacompras').html(compras); 
        
        
        
      
    
    },
    
    error: function (response) {
    $("#notifigener").removeClass('w3-green').addClass('w3-red');
    $("#notifigener").html('<p>Sin conexión a intertet</p>');
    $("#notifigener").show();
    setTimeout(function(){ $("#notifigener").hide(); }, 6000);
    }
    
    });
    }
    
    setInterval(function(){orderBook(); }, 3000);
    
    </script>