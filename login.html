<!doctype html>
<html lang="en">

<head>
  <base href="auth/">
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="fonts/icomoon/style.css">

  <link rel="stylesheet" href="css/owl.carousel.min.css">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="css/bootstrap.min.css">

  <!-- Style -->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="../font-awesome/6.1.1/css/all.css">
  <link rel="stylesheet" href="../assets/css/w3pro-4.13.css">

  <link rel="stylesheet" href="../css/w3.css">
  <title>PAI | Login</title>
</head>

<body>


  <div class="d-lg-flex half">
    <div class="bg order-1 order-md-2" style="background-image: url('images/bg_1.jpg');"></div>
    <div class="contents order-2 order-md-1">

      <div class="container">
        <div class="row align-items-center justify-content-center">
          <div class="col-md-7">

            <!-- Page content -->
            <div id="notifigener" class="w3-animate-top w3-col m12 s12 l12 w3-container w3-center"
              style="position:fixed;display:none;z-index:2"></div>


            <div class="w3-container w3-white">

              <form class="w3-margin-top w3-margin-bottom w3-container">
                <center>
                  <img src="../icon/pai.png" class="w3-circle w3-light-grey" width="70px">
                  <small class="w3-col s12 m12 l12"><b>PAI </b>Exchange</small>
                </center>
                <br><br>
                <div id="loginarea">
                  <center>
                    <h3>Inicio de sesion de <strong>PAI</strong></h3>
                  </center>
                  <p class="mb-4">Sus datos estan protegidos.</p>
                  <form action="#" method="post">
                    <div class="form-group first">
                      <label for="username">Usuario</label>
                      <input type="text" class="form-control" placeholder="Email o usuario" id='user_name'>
                    </div>
                    <div class="form-group last mb-3">
                      <label for="password">Contraseña</label>
                      <input type="password" class="form-control" placeholder="Tu contraseña" id='psw'>
                    </div>

                    <div class="d-flex mb-5 align-items-center">
                      <label class="control control--checkbox mb-0"><span class="caption">Recordar sesion</span>
                        <input type="checkbox" checked="checked" />
                        <div class="control__indicator"></div>
                      </label>
                      <span class="ml-auto"><a href="#" class="forgot-pass">Olvidaste la contraseña?</a></span>
                    </div>

                    <input type="submit" value="Acceder"
                      onclick="enter($('#user_name').val(),$('#psw').val());return false"
                      class="btn btn-block btn-primary">
                </div>

                <div id="2farea" style="display: none;">
                  <center>
                    <h3>Ingresa tu codigo <strong>2FA</strong></h3>
                  </center>
                  <p class="mb-4">Es el codigo de seguridad de tu aplicacion.</p>
                  <div class="form-group first mb-5">
                    <label for="username">2FA autenticador</label>
                    <input type="number" id='2fa' placeholder="Código 2fa"
                      oninput="if(value.length==6){ Twofactor(value); }" class="form-control">
                  </div>

                  <input type="submit" value="Acceder"
                    onclick="enter($('#user_name').val(),$('#psw').val());return false"
                    class="btn btn-block btn-primary">

                </div>
              </form>

              <br><br><br>

              <center>
                Aun no tienes una cuenta? <a href="">Registrate.</a>
              </center>

            </div>





            <br><br><br>
            <footer class="w3-botttom w3-container w3-center  w3-margin-bottom">
              <i onclick="abrirEnlaceExterno('https://fb.com/paiexchange')"
                class="fab fa-facebook  fa-2x w3-text-blue   w3-col s2 m2 l2"></i>
              <i onclick="abrirEnlaceExterno('https://instagram.com/paiexchange')"
                class="fab fa-instagram fa-2x w3-text-pink   w3-col s2 m2 l2"></i>
              <i onclick="abrirEnlaceExterno('https://t.me/paiexchange')"
                class="fab fa-telegram  fa-2x w3-text-cyan   w3-col s2 m2 l2"></i>
              <i onclick="abrirEnlaceExterno('https://youtube.com/c/paiexchange')"
                class="fab fa-youtube   fa-2x w3-text-red    w3-col s2 m2 l2"></i>
              <i onclick="abrirEnlaceExterno('https://twitter.com/paiexchange')"
                class="fab fa-twitter   fa-2x w3-text-blue   w3-col s2 m2 l2"></i>
              <i onclick="abrirEnlaceExterno('mailto:soporte@paiexchange.com')"
                class="fas fa-envelope  fa-2x w3-text-yellow w3-col s2 m2 l2"></i>
            </footer>
            <div class="w3-margin-bottom w3-text-blue-grey w3-container w3-center">
              <p> ® PAI Exchange.</p>
            </div>
          </div>
        </div>
      </div>


    </div>
   
    <!-- Loader -->
    <div id="loadergif" class="w3-modal">
      <div class="w3-display-middle">
        <center>
          <img src="../icon/loader.gif" class="w3-round" width="70">
        </center>
      </div>
    </div>
    <!-- // Loader// -->
    <script>
      if (/(http)/i.test(window.location.protocol)) {
        UrlAPI = window.location.hostname;
      }
      else {
        UrlAPI = 'api.paiexchange.com';
      }
    </script>
    <script>
      function abrirEnlaceExterno(enlace) {
        if (AppenUso == true) {
          cordova.InAppBrowser.open(enlace, '_system');
        }
        else {
          window.open(enlace, '_system')
        }
      }    
    </script>
    <script>
      function toggleInput(value) {
        if (value == 'lock') {
          $('#psw').attr('type', 'text');
          $('#lock').removeClass('fa-solid fa-lock').addClass('fa-solid fa-lock-open');
          $('#lock').attr('data', 'unlock');
        }
        else {
          $('#psw').attr('type', 'password');
          $('#lock').removeClass('fa-solid fa-lock-open').addClass('fa-solid fa-lock');
          $('#lock').attr('data', 'lock');
        }
      }  
    </script>

    <script>
      function enter(user, psw) {
        if (user == '') {
          $("#user_name").focus();
        }
        else if (psw == '') {
          $("#psw").focus();
        }
        else {

          var parametros = {
            "user": user,
            "psw": psw,

          };
          $.ajax({
            data: parametros,
            url: 'https://' + UrlAPI + '/app_login',
            type: 'post',
            beforeSend: function () {
              $('#loadergif').show();
            },
            success: function (response) {

              $("#loadergif").hide();
              if (response == '') {
                $("#notifigener").removeClass('w3-green').addClass('w3-red');
                $("#notifigener").html("<p> Hay un problema con el servidor</p>");
                $("#notifigener").show();
                setTimeout(function () { $("#notifigener").hide(); }, 6000);
              }
              else if (response == 'ok2') {

                $('#loginarea').hide();
                $('#2farea').show();
                $('#2fa').focus();

              }
              else if (response == 'ok') {

                localStorage.setItem("Sesion", "true");
                window.location.href = "../panel.html";

              }
              else {
                $("#notifigener").removeClass('w3-green').addClass('w3-red');
                $("#notifigener").html("<p>" + response + "</p>");
                $("#notifigener").show();
                setTimeout(function () { $("#notifigener").hide(); }, 6000);
              }

            },

            error: function (response) {
              $("#notifigener").removeClass('w3-green').addClass('w3-red');
              $("#notifigener").html("<p> Favor verifique su conexión a internet</p>");
              $("#notifigener").show();
              setTimeout(function () { $("#notifigener").hide(); }, 6000);
              $("#loadergif").hide();
            }

          });
        }
      }
    </script>


    <script>
      function Twofactor(code) {

        var parametros = {
          "code": code,
        };
        $.ajax({
          data: parametros,
          url: 'https://' + UrlAPI + '/2fa_sesion',
          type: 'post',
          beforeSend: function () {
            $('#loadergif').show();
          },
          success: function (response) {

            $("#loadergif").hide();
            if (response == '') {
              $("#notifigener").removeClass('w3-green').addClass('w3-red');
              $("#notifigener").html("<p> Hay un problema con el servidor</p>");
              $("#notifigener").show();
              setTimeout(function () { $("#notifigener").hide(); }, 6000);
            }
            else if (response == 'ok') {
              localStorage.setItem("Sesion", "true");
              window.location.href = "../panel.html";

            } else {
              $("#notifigener").removeClass('w3-green').addClass('w3-red');
              $("#notifigener").html("<p>Error código incorrecto</p>");
              $("#notifigener").show();
              $('#2fa').val('');
              setTimeout(function () { $("#notifigener").hide(); }, 6000);
            }

          },

          error: function (response) {
            $("#notifigener").removeClass('w3-green').addClass('w3-red');
            $("#notifigener").html("<p> Favor verifique su conexión a internet</p>");
            $("#notifigener").show();
            setTimeout(function () { $("#notifigener").hide(); }, 6000);
            $("#loadergif").hide();
          }

        });
      }
    </script>
    <script>
      function NotifiAlert(mensaje, color, tiempo) {
        if (color == 'w3-green') { remov = 'w3-red'; } else { remov = 'w3-green'; }

        $("#notifigener").removeClass(remov).addClass(color);
        $("#notifigener").html("<p>" + mensaje + "</p>");
        $("#notifigener").show();
        setTimeout(function () { $("#notifigener").hide(); }, tiempo);
      }     
    </script>

    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>
</body>

</html>